# Gitleaks Configuration for claude-code-manager
# Version: 1.0.0
# Purpose: Prevent secrets and PII from being pushed to GitHub

title = "claude-code-manager security scan"

[extend]
# Extend the default gitleaks rules
useDefault = true

# ============================================
# CUSTOM RULES FOR PII AND SECRETS
# ============================================

[[rules]]
id = "anthropic-api-key"
description = "Anthropic API Key"
regex = '''(?i)(anthropic[_-]?api[_-]?key|sk-ant-)[a-zA-Z0-9_-]{20,}'''
tags = ["key", "anthropic", "api"]

[[rules]]
id = "openai-api-key"
description = "OpenAI API Key"
regex = '''sk-[a-zA-Z0-9]{20,}'''
tags = ["key", "openai", "api"]

[[rules]]
id = "social-security-number"
description = "Social Security Number (SSN)"
regex = '''\b\d{3}[-]?\d{2}[-]?\d{4}\b'''
tags = ["pii", "ssn"]
keywords = ["ssn", "social"]

[[rules]]
id = "phone-number-us"
description = "US Phone Number"
regex = '''\b(?:\+1[-.\s]?)?\(?[2-9]\d{2}\)?[-.\s]?\d{3}[-.\s]?\d{4}\b'''
tags = ["pii", "phone"]
keywords = ["phone", "tel", "mobile", "cell"]

[[rules]]
id = "email-personal"
description = "Personal Email Address (non-example)"
regex = '''[a-zA-Z0-9._%+-]+@(?!example\.com|test\.com|localhost)[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'''
tags = ["pii", "email"]
# Exclude common test/example patterns
allowlist = [
  '''@example\.com''',
  '''@test\.com''',
  '''@localhost''',
  '''noreply@''',
  '''no-reply@''',
]

[[rules]]
id = "credit-card"
description = "Credit Card Number"
regex = '''\b(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})\b'''
tags = ["pii", "financial", "credit-card"]

[[rules]]
id = "ip-address-private"
description = "Private IP Address (potential internal network exposure)"
regex = '''\b(?:192\.168\.\d{1,3}\.\d{1,3}|10\.\d{1,3}\.\d{1,3}\.\d{1,3}|172\.(?:1[6-9]|2[0-9]|3[0-1])\.\d{1,3}\.\d{1,3})\b'''
tags = ["network", "internal"]
# Only flag if in config or code, not in docs
path = '''(?i)(?:\.env|\.config|\.json|\.js|\.ts|\.jsx|\.tsx)$'''

[[rules]]
id = "database-connection-string"
description = "Database Connection String with Credentials"
regex = '''(?i)(mongodb|postgresql|mysql|redis|amqp):\/\/[^:]+:[^@]+@[^\s]+'''
tags = ["secret", "database"]

[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[a-zA-Z0-9_-]*\.eyJ[a-zA-Z0-9_-]*\.[a-zA-Z0-9_-]*'''
tags = ["secret", "jwt", "token"]

[[rules]]
id = "bearer-token"
description = "Bearer Token in Code"
regex = '''(?i)bearer\s+[a-zA-Z0-9_-]{20,}'''
tags = ["secret", "token"]

[[rules]]
id = "password-assignment"
description = "Hardcoded Password Assignment"
regex = '''(?i)(?:password|passwd|pwd|secret)\s*[=:]\s*['\"][^'\"]{8,}['\"]'''
tags = ["secret", "password"]
# Exclude obvious placeholder patterns
allowlist = [
  '''password.*example''',
  '''password.*changeme''',
  '''password.*placeholder''',
  '''process\.env''',
]

[[rules]]
id = "home-directory-path"
description = "User Home Directory Path"
regex = '''\/home\/[a-zA-Z][a-zA-Z0-9_-]+\/'''
tags = ["pii", "path"]
# Allow in CLAUDE.md and docs (expected there)
allowlist = [
  '''CLAUDE\.md''',
  '''README\.md''',
  '''\/home\/\$USER''',
  '''\/home\/\{username\}''',
  '''~\/Projects''',
]

[[rules]]
id = "aws-access-key"
description = "AWS Access Key ID"
regex = '''(?:A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'''
tags = ["secret", "aws", "key"]

[[rules]]
id = "aws-secret-key"
description = "AWS Secret Access Key"
regex = '''(?i)aws[_-]?secret[_-]?(?:access[_-]?)?key['\"]?\s*[:=]\s*['\"]?[A-Za-z0-9/+=]{40}'''
tags = ["secret", "aws", "key"]

[[rules]]
id = "github-token"
description = "GitHub Personal Access Token"
regex = '''gh[pousr]_[A-Za-z0-9_]{36,}'''
tags = ["secret", "github", "token"]

[[rules]]
id = "slack-token"
description = "Slack Token"
regex = '''xox[baprs]-[0-9]{10,13}-[0-9]{10,13}-[a-zA-Z0-9]{24}'''
tags = ["secret", "slack", "token"]

[[rules]]
id = "stripe-key"
description = "Stripe API Key"
regex = '''(?:sk|pk)_(?:test|live)_[a-zA-Z0-9]{24,}'''
tags = ["secret", "stripe", "key"]

[[rules]]
id = "authentik-secret"
description = "Authentik Secret"
regex = '''(?i)authentik[_-]?(?:client[_-]?)?secret['\"]?\s*[:=]\s*['\"]?[a-zA-Z0-9_-]{20,}'''
tags = ["secret", "authentik"]

# ============================================
# ALLOWLIST - FILES AND PATTERNS TO IGNORE
# ============================================

[allowlist]
description = "Global allowlist"

# Files that are expected to have example secrets
paths = [
  '''\.env\.example$''',
  '''\.env\.sample$''',
  '''\.env\.template$''',
  '''package-lock\.json$''',
  '''yarn\.lock$''',
  '''pnpm-lock\.yaml$''',
  '''node_modules/''',
  '''dist/''',
  '''build/''',
  '''\.git/''',
  '''coverage/''',
  '''\.gitleaks\.toml$''',
  '''scripts/sanitize-push\.sh$''',
]

# Common false-positive patterns
regexes = [
  '''example@example\.com''',
  '''test@test\.com''',
  '''user@localhost''',
  '''placeholder''',
  '''your-.*-here''',
  '''<.*>''',
  '''\$\{.*\}''',
  '''process\.env\.[A-Z_]+''',
]

# Console.web Log Rotation Configuration
# Install: sudo cp config/logrotate.conf /etc/logrotate.d/console-web
# Test: sudo logrotate -d /etc/logrotate.d/console-web

/var/log/console-web/*.log {
    # Rotate daily
    daily

    # Keep 14 days of logs
    rotate 14

    # Compress old logs
    compress

    # Delay compression to avoid issues with active files
    delaycompress

    # Don't error if log file is missing
    missingok

    # Don't rotate if empty
    notifempty

    # Create new log file with proper permissions
    create 0640 appuser appuser

    # Run scripts only once per rotation
    sharedscripts

    # Signal PM2 to reopen log files after rotation
    postrotate
        pm2 reloadLogs 2>/dev/null || true
    endscript
}

# Watcher service logs (separate rotation policy)
/logs/watcher.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 appuser appuser
}
